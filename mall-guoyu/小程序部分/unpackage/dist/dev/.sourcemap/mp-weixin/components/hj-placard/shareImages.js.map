{"version":3,"sources":["webpack:///E:/github/guoyu/unimall-app/components/hj-placard/shareImages.vue?98b2","webpack:///E:/github/guoyu/unimall-app/components/hj-placard/shareImages.vue?2745","webpack:///E:/github/guoyu/unimall-app/components/hj-placard/shareImages.vue?58bd","webpack:///E:/github/guoyu/unimall-app/components/hj-placard/shareImages.vue?5d8f","uni-app:///components/hj-placard/shareImages.vue"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAwH;AACxH;AAC+D;AACL;;;AAG1D;AACsK;AACtK,gBAAgB,6KAAU;AAC1B,EAAE,iFAAM;AACR,EAAE,sFAAM;AACR,EAAE,+FAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,0FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAunB,CAAgB,qnBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;ACW3oB,U;;AAEA,uB;AACA;AACA;AACA;AACA,kBADA;AAEA,4BAFA,EAFA;;AAMA;AACA,iBADA;AAEA,kBAFA,EANA;;AAUA;AACA,iBADA;AAEA,kBAFA,EAVA;;AAcA;AACA,oBADA;AAEA,0BAFA,EAdA;;AAkBA;AACA,oBADA;AAEA,2CAFA,EAlBA;;AAsBA;AACA,oBADA;AAEA,kBAFA,EAtBA;;AA0BA;AACA,oBADA;AAEA,kBAFA,EA1BA;;AA8BA;AACA,oBADA;AAEA,oCAFA,EA9BA;;AAkCA;AACA,iBADA;AAEA,kBAFA,EAlCA;;AAsCA;AACA,oBADA;AAEA,yDAFA,EAtCA,E;;;AA2CA;AACA,kBADA,E;;AAGA,M,kBAAA;AACA;AACA,gBADA,CACA;AADA;AAGA,G;AACA,S,qBAAA;AACA;AACA,G;AACA;AACA;AACA,gBAFA,0BAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,2CApBA;AAqBA,kCArBA;AAsBA,KAxBA;AAyBA;AACA,YA1BA,sBA0BA;AACA;AACA,qCADA;;AAGA,mBAJA,GAIA,8CAJA;AAKA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,kEAlBA;AAmBA,6DAnBA,UAmBA,cAnBA;AAoBA;AACA,uBArBA,GAqBA,sBArBA;AAsBA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAzCA,GAyCA,mCAzCA;AA0CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAvDA,GAuDA,iDAvDA;AAwDA;AACA;AACA;AACA,yBA3DA,GA2DA,+BA3DA;AA4DA;AACA;AACA;AACA;;AAEA;AACA,yCAlEA;AAmEA,wDAnEA,UAmEA,GAnEA;AAoEA;AACA,sBArEA,GAqEA,WArEA;AAsEA;AACA;;;AAGA;AA1EA,2CA2EA,kBA3EA,SA2EA,GA3EA;AA4EA;AACA,mCA7EA;AA8EA,KAxGA;AAyGA,iBAzGA,yBAyGA,GAzGA,EAyGA,KAzGA,EAyGA,MAzGA,EAyGA,MAzGA,EAyGA,WAzGA,EAyGA,YAzGA,EAyGA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAnIA;AAoIA;;;;;;;;AAQA,qBA5IA,6BA4IA,MA5IA,EA4IA,UA5IA,EA4IA,UA5IA,EA4IA,IA5IA,EA4IA,SA5IA,EA4IA,QA5IA,EA4IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAFA,MAEA;AACA;AACA;AACA;AACA,WAPA,MAOA;AACA;AACA;AACA,aAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KApLA;AAqLA;AACA,WAtLA,mBAsLA,GAtLA,EAsLA;AACA;AACA;AACA;AACA,uCADA,SACA,GADA;AAEA,gCAFA;;AAIA,SALA,EAKA,GALA;AAMA,OAPA;AAQA,KA/LA;AAgMA;AACA,aAjMA,uBAiMA;AACA;AACA;AACA;AACA,oCADA;AAEA,sBAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA,aATA;AAUA,eAVA;AAWA,SAZA,EAYA,GAZA;AAaA,OAdA;AAeA,KAjNA,E;;AAmNA;AACA;AACA,C","file":"components/hj-placard/shareImages.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./shareImages.vue?vue&type=template&id=30a52b4d&\"\nvar renderjs\nimport script from \"./shareImages.vue?vue&type=script&lang=js&\"\nexport * from \"./shareImages.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/hj-placard/shareImages.vue\"\nexport default component.exports","export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shareImages.vue?vue&type=template&id=30a52b4d&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shareImages.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./shareImages.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view style=\"position: fixed;z-index: -9999;\">\r\n\t\t<canvas :canvas-id=\"canvasID\" :style=\"{width:canvasWidth+'px',height:canvasHeight+'px'}\"></canvas>\r\n\t\t<view v-if=\"qrCode == ''\">\r\n\t\t\t<QRCode ref=\"qrcode\" />\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport QRCode from \"../qr_code/qrcode.vue\"\r\n\tvar _this;\r\n\texport default {\r\n\t\tname: 'canvas-images',\r\n\t\tprops: {\r\n\t\t\t// canvasID 等同于 canvas-id\r\n\t\t\tcanvasID: {\r\n\t\t\t\tType: String,\r\n\t\t\t\tdefault: 'shareCanvas'\r\n\t\t\t},\r\n\t\t\tcanvasWidth:{\t// 画布宽度\r\n\t\t\t\tType: 'int',\r\n\t\t\t\tdefault: 375\r\n\t\t\t},\r\n\t\t\tcanvasHeight:{\t// 画布高度\r\n\t\t\t\tType: 'int',\r\n\t\t\t\tdefault: 500\r\n\t\t\t},\r\n\t\t\tshareTitle:{\t// 分享标题\r\n\t\t\t\tType: 'String',\r\n\t\t\t\tdefault: '我是这张图片的标题'\r\n\t\t\t},\r\n\t\t\tgoodsTitle:{\t// 商品宣传标题\r\n\t\t\t\tType: 'String',\r\n\t\t\t\tdefault: '我是这张图片的标题我是这张图片的标题我是这张图片的标'\r\n\t\t\t},\r\n\t\t\tgoodsPrice:{\t// 商品秒杀价\r\n\t\t\t\tType: 'Number',\r\n\t\t\t\tdefault: 0.0\r\n\t\t\t},\r\n\t\t\tgoodsOriginalPrice:{\t// 商品日常价\r\n\t\t\t\tType: 'Number',\r\n\t\t\t\tdefault: 0.0\r\n\t\t\t},\r\n\t\t\tshareImage:{\t// 分享图片\r\n\t\t\t\tType: 'String',\r\n\t\t\t\tdefault: '../../static/bg.jpg'\r\n\t\t\t},\r\n\t\t\tqrSize:{\t// 二维码大小\r\n\t\t\t\tType: 'int',\r\n\t\t\t\tdefault: 100\r\n\t\t\t},\r\n\t\t\tqrUrl:{\t\t// 生成二维码的链接\r\n\t\t\t\tType: 'String',\r\n\t\t\t\tdefault: 'https://ext.dcloud.net.cn/plugin?id=5747'\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomponents:{\r\n\t\t\tQRCode\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tqrCode:'',\t// 二维码\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted(){\r\n\t\t\t_this = this;\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 创建二维码\r\n\t\t\tasync canvasCreate(){\r\n\t\t\t\t// let res = await _this.$refs.qrcode.make({size: _this.qrSize,text: _this.qrUrl})\r\n\t\t\t\t// \t// .then(async res => {\r\n\t\t\t\t// \t// \t// 返回的res与uni.canvasToTempFilePath返回一致\r\n\t\t\t\t// \t// \t// console.log(res)\r\n\t\t\t\t// \t// \t_this.qrCode = res.tempFilePath;\r\n\t\t\t\t// \t// \tawait _this.onCanvas();\r\n\t\t\t\t// \t// });\r\n\t\t\t\t\t\r\n\t\t\t\t// // 返回的res与uni.canvasToTempFilePath返回一致\r\n\t\t\t\t// // console.log(res)\r\n\t\t\t\t// _this.qrCode = res.tempFilePath;\r\n\t\t\t\t// await _this.onCanvas();\r\n\t\t\t\t\r\n\t\t\t\t// console.log('qrUrl', _this.qrUrl)\r\n\t\t\t\t// const img = await _this.getImage(_this.qrUrl)\r\n\t\t\t\t// // 给出下载到本地的图片的临时路径\r\n\t\t\t\t// _this.qrCode = img.path\r\n\t\t\t\t// console.log('qr code path', _this.qrCode)\r\n\t\t\t\t\r\n\t\t\t\t_this.qrCode = _this.qrUrl\r\n\t\t\t\tawait _this.onCanvas();\r\n\t\t\t},\r\n\t\t\t// 画图\r\n\t\t\tasync onCanvas() {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\ttitle: \"分享图片生成中...\"\r\n\t\t\t\t});\r\n\t\t\t\tconst ctx = uni.createCanvasContext(_this.canvasID, _this);\r\n\t\t\t\t// 设置 canvas 背景色\r\n\t\t\t\tctx.setFillStyle('#FF4038');\r\n\t\t\t\tctx.fillRect(0, 0, _this.canvasWidth, _this.canvasHeight);\r\n\t\t\t\t\r\n\t\t\t\tthis.drawRoundRect(ctx, _this.canvasWidth - 20, _this.canvasHeight - 60, 5, 10, 50)\r\n\t\t\t\t\r\n\t\t\t\t// ctx.strokeStyle = \"#fff\";\r\n\t\t\t\t// ctx.stroke();\r\n\t\t\t\tctx.fillStyle = '#fff';\r\n\t\t\t\tctx.fill();\r\n\t\t\t\t// ctx.setFillStyle('#fff')\r\n\t\t\t\tctx.restore();\r\n\t\t\t\t\r\n\t\t\t\tconsole.log('_this.shareImage', _this.shareImage)\r\n\t\t\t\tconst res_shareImage = await uni.getImageInfo({src: _this.shareImage})\r\n\t\t\t\tconsole.log(res_shareImage)\r\n\t\t\t\tlet imgPath = res_shareImage[1].path\r\n\t\t\t\t// 背景图片\r\n\t\t\t\tctx.drawImage(imgPath, 20, 60,_this.canvasWidth - 40, _this.canvasHeight - 200);\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\tctx.setFillStyle('#fff');\r\n\t\t\t\tctx.setFontSize(18);\r\n\t\t\t\tctx.setTextAlign('center');\r\n\t\t\t\tctx.fillText(_this.shareTitle, _this.canvasWidth/2, 30);\r\n\t\t\t\t// 左边标题\r\n\t\t\t\tctx.setFillStyle('#000000');\r\n\t\t\t\tctx.setTextAlign('left')\r\n\t\t\t\tctx.setFontSize(16)\r\n\t\t\t\t_this.writeTextOnCanvas(ctx,30,21,_this.goodsTitle,20, _this.canvasHeight - 100);\r\n\t\t\t\t// 秒杀价\r\n\t\t\t\tctx.setFillStyle('#000000');\r\n\t\t\t\tctx.setTextAlign('left')\r\n\t\t\t\tctx.setFontSize(14)\r\n\t\t\t\t_this.writeTextOnCanvas(ctx,30,21,'秒杀价',20, _this.canvasHeight - 60);\r\n\t\t\t\t// 秒杀价价格\r\n\t\t\t\tconst price = (_this.goodsPrice / 100).toString()\r\n\t\t\t\t_this.writeTextOnCanvas(ctx,30,21, '￥',70, _this.canvasHeight - 60);\r\n\t\t\t\tctx.setFillStyle('#ff0000');\r\n\t\t\t\tctx.setFontSize(32)\r\n\t\t\t\t_this.writeTextOnCanvas(ctx,60,21, price,85, _this.canvasHeight - 60);\r\n\t\t\t\t// 日常价\r\n\t\t\t\tctx.setFillStyle('#000000');\r\n\t\t\t\tctx.setTextAlign('left')\r\n\t\t\t\tctx.setFontSize(14)\r\n\t\t\t\t_this.writeTextOnCanvas(ctx,30,21,'日常价',20, _this.canvasHeight - 20);\r\n\t\t\t\t// 日常价价格\r\n\t\t\t\tctx.setFillStyle('#000000');\r\n\t\t\t\tctx.setTextAlign('left')\r\n\t\t\t\tctx.setFontSize(16)\r\n\t\t\t\tconst oriPrice = '￥' + (_this.goodsOriginalPrice / 100).toString()\r\n\t\t\t\t_this.writeTextOnCanvas(ctx,30,21,oriPrice,70, _this.canvasHeight - 20);\r\n\t\t\t\t// 日常价价格删除线\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tconst textWidth = ctx.measureText(oriPrice).width;\n\t\t\t\tctx.rect(70, _this.canvasHeight - 27.5, textWidth, 1);\n\t\t\t\tctx.fillStyle = '#000';\n\t\t\t\tctx.fill();\r\n\t\t\t\tctx.closePath()\r\n\t\t\t\t\r\n\t\t\t\t// 二维码\r\n\t\t\t\tconsole.log(_this.qrUrl)\r\n\t\t\t\tconst res = await uni.getImageInfo({src: _this.qrUrl})\r\n\t\t\t\tconsole.log(res)\r\n\t\t\t\tlet qrPath = res[1].path\r\n\t\t\t\tctx.drawImage(qrPath,_this.canvasWidth - 120,_this.canvasHeight - 120,100,100);\r\n\t\t\t\t// ctx.draw();\r\n\t\t\t\t\r\n\t\t\t\t\r\n\t\t\t\t// 延迟后渲染至canvas上\r\n\t\t\t\tlet pic = await _this.setTime(ctx)\r\n\t\t\t\t_this.$emit('success', pic);\r\n\t\t\t\t_this.qr_code = '';\r\n\t\t\t},\r\n\t\t\tdrawRoundRect(ctx, width, height, radius, widthOffset, heightOffset) {\r\n\t\t\t\tctx.beginPath(0);\r\n\t\t\t\t//从右下角顺时针绘制，弧度从0到1/2PI  \r\n\t\t\t\tctx.arc(width - radius + widthOffset, height - radius + heightOffset, radius, 0, Math.PI / 2);\r\n\t\t\r\n\t\t\t\t//矩形下边线  \r\n\t\t\t\tctx.lineTo(radius + widthOffset, height + heightOffset);\r\n\t\t\r\n\t\t\t\t//左下角圆弧，弧度从1/2PI到PI  \r\n\t\t\t\tctx.arc(radius + widthOffset, height - radius + heightOffset, radius, Math.PI / 2, Math.PI);\r\n\t\t\r\n\t\t\t\t//矩形左边线  \r\n\t\t\t\tctx.lineTo(0 + widthOffset, radius + heightOffset);\r\n\t\t\r\n\t\t\t\t//左上角圆弧，弧度从PI到3/2PI  \r\n\t\t\t\tctx.arc(radius + widthOffset, radius + heightOffset, radius, Math.PI, Math.PI * 3 / 2);\r\n\t\t\r\n\t\t\t\t//上边线  \r\n\t\t\t\tctx.lineTo(width - radius + widthOffset, 0 + heightOffset);\r\n\t\t\r\n\t\t\t\t//右上角圆弧  \r\n\t\t\t\tctx.arc(width - radius + widthOffset, radius + heightOffset, radius, Math.PI * 3 / 2, Math.PI * 2);\r\n\t\t\r\n\t\t\t\t//右边线  \r\n\t\t\t\tctx.lineTo(width + widthOffset, height - radius + heightOffset);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * @param {Object} ctx_2d\tgetContext(\"2d\") 对象\r\n\t\t\t * @param {int} lineheight\t段落文本行高\r\n\t\t\t * @param {int} bytelength\t设置单字节文字一行内的数量\r\n\t\t\t * @param {string} text\t\t写入画面的段落文本\r\n\t\t\t * @param {int} startleft\t开始绘制文本的 x 坐标位置（相对于画布）\r\n\t\t\t * @param {int} starttop\t开始绘制文本的 y 坐标位置（相对于画布）\r\n\t\t\t */\r\n\t\t\twriteTextOnCanvas(ctx_2d, lineheight, bytelength, text ,startleft, starttop){\r\n\t\t\t\t// 获取字符串的真实长度（字节长度）\r\n\t\t\t\tfunction getTrueLength(str){\r\n\t\t\t\t\tvar len = str.length, truelen = 0;\r\n\t\t\t\t\tfor(var x = 0; x < len; x++){\r\n\t\t\t\t\t\tif(str.charCodeAt(x) > 128){\r\n\t\t\t\t\t\t\ttruelen += 2;\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\ttruelen += 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn truelen;\r\n\t\t\t\t}\r\n\t\t\t\t// 按字节长度截取字符串，返回substr截取位置\r\n\t\t\t\tfunction cutString(str, leng){\r\n\t\t\t\t\tvar len = str.length, tlen = len, nlen = 0;\r\n\t\t\t\t\tfor(var x = 0; x < len; x++){\r\n\t\t\t\t\t\tif(str.charCodeAt(x) > 128){\r\n\t\t\t\t\t\t\tif(nlen + 2 < leng){\r\n\t\t\t\t\t\t\t\tnlen += 2;\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\ttlen = x;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\tif(nlen + 1 < leng){\r\n\t\t\t\t\t\t\t\tnlen += 1;\r\n\t\t\t\t\t\t\t}else{\r\n\t\t\t\t\t\t\t\ttlen = x;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn tlen;\r\n\t\t\t\t}\r\n\t\t\t\tfor(var i = 1; getTrueLength(text) > 0; i++){\r\n\t\t\t\t\tvar tl = cutString(text, bytelength);\r\n\t\t\t\t\tctx_2d.fillText(text.substr(0, tl).replace(/^\\s+|\\s+$/, \"\"), startleft, (i-1) * lineheight + starttop);\r\n\t\t\t\t\ttext = text.substr(tl);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 彻底改成同步 防止拿到的图片地址为空\r\n\t\t\tsetTime(ctx) {\r\n\t\t\t\treturn new Promise((resole, err) => {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tctx.draw(false, async () => {\r\n\t\t\t\t\t\t\tlet pic = await _this.getNewPic();\r\n\t\t\t\t\t\t\tresole(pic)\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}, 600)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 获取新的图片地址\r\n\t\t\tgetNewPic() {\r\n\t\t\t\treturn new Promise((resolve, errs) => {\r\n\t\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\t\tuni.canvasToTempFilePath({\r\n\t\t\t\t\t\t\tcanvasId: _this.canvasID,\r\n\t\t\t\t\t\t\tquality: 1,\r\n\t\t\t\t\t\t\tcomplete: (res) => {\r\n\t\t\t\t\t\t\t\t// 在H5平台下，tempFilePath 为 base64\r\n\t\t\t\t\t\t\t\t// 关闭showLoading\r\n\t\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t\t\t//  储存海报地址  也是分享的地址\r\n\t\t\t\t\t\t\t\tresolve(res.tempFilePath)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, _this);\r\n\t\t\t\t\t},200)\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\t_this = this;\r\n\t\t}\r\n\t}\r\n</script>"],"sourceRoot":""}