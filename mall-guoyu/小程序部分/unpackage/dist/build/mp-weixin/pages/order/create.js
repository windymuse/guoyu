(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/create"],{"0f19":function(e,t,r){"use strict";r.r(t);var n=r("5eae"),i=r.n(n);for(var a in n)"default"!==a&&function(e){r.d(t,e,(function(){return n[e]}))}(a);t["default"]=i.a},2568:function(e,t,r){},3735:function(e,t,r){"use strict";(function(e){r("f494");n(r("66fd"));var t=n(r("76b9"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])},3890:function(e,t,r){"use strict";var n=r("2568"),i=r.n(n);i.a},"5eae":function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(r("a34a")),i=r("26cb");function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t,r,n,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,i)}function d(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var a=e.apply(t,r);function o(e){c(a,n,i,o,s,"next",e)}function s(e){c(a,n,i,o,s,"throw",e)}o(void 0)}))}}var f={data:function(){return{currVipDegree:{},orderReqeust:{skuList:[],totalOriginalPrice:0,totalPrice:0,coupon:void 0,mono:"",takeWay:"",freightPrice:0,addressId:void 0,selfTake:0},skuCategoryPriceMap:{},maskState:0,couponList:[],isVip:!1,addressData:{consignee:"",phone:"",province:"",city:"",county:"",address:"",defaultAddress:!1},submiting:!1,merchantConfig:{}}},onShow:function(){this.isVip=this.$api.isVip()},onLoad:function(e){var t=this;return d(n.default.mark((function r(){var i,a,o,s;return n.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return i=t,r.next=3,t.loadMemberLevel();case 3:i.$api.request("config","getMerchantConfig",{},(function(e){i.$api.msg(e.errmsg)})).then((function(e){console.log("商户信息",e.data),i.merchantConfig=e.data})),t.isVip=t.$api.isVip(),e.takeway&&(i.orderReqeust.takeWay=e.takeway),i.orderReqeust.skuList=i.$api.globalData.skuList,i.orderReqeust.selfTake=i.$api.globalData.selfTake,a=0,o=0,s={},i.orderReqeust.skuList.forEach((function(e){a+=e.originalPrice*e.num,o+=i.isVip?e.vipPrice*e.num:e.price*e.num,e.categoryIdList.forEach((function(t){s[t]?s[t]+=i.isVip?e.vipPrice*e.num:e.price*e.num:s[t]=i.isVip?e.vipPrice:e.price}))})),i.skuCategoryPriceMap=s,i.orderReqeust.totalOriginalPrice=a,i.orderReqeust.totalPrice=o*i.currVipDegree.percent/100,i.$api.request("coupon","getUserCoupons").then((function(e){i.couponList=e.data})),i.$api.request("address","getDefAddress").then((function(e){i.addressData=e.data,i.calcFreightPrice()})),1===i.orderReqeust.skuList.length&&i.orderReqeust.skuList[0].groupShopId&&(i.orderReqeust.groupShopId=i.orderReqeust.skuList[0].groupShopId),console.log("order request",t.orderReqeust);case 19:case"end":return r.stop()}}),r)})))()},onShareAppMessage:function(){return{title:"国渔鲜生小程序",desc:"全球鲜生供应商",path:"/pages/index/index"}},onShareTimeline:function(){return{}},computed:s(s({},(0,i.mapState)(["hasLogin","userInfo"])),{},{inBusinessHour:function(){if(!this.merchantConfig.startTime)return!1;var e=new Date,t=e.getHours(),r=e.getMinutes(),n=this.merchantConfig.startTime.split(":"),i=this.merchantConfig.endTime.split(":");return!(t+1<n[0]||t+1==n[0]&&r+1<n[1])&&!(t+1>i[0]||t+1==i[0]&&r+1>i[1])}}),methods:{loadMemberLevel:function(){var e=this;return d(n.default.mark((function t(){var r,i,a;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e,t.next=3,r.$api.request("member_level","getMemberLevel",{degree:r.userInfo.level,page:1,limit:1},(function(e){r.$api.msg(e.errmsg)}));case 3:i=t.sent,a=i.data,console.log("curr level",a),a&&a.length>0&&(e.currVipDegree=a[0],console.log("curr vip degree",e.currVipDegree));case 7:case"end":return t.stop()}}),t)})))()},backtoCart:function(){e.reLaunch({url:"/pages/cart/cart"})},changeSelfTake:function(e){console.log(e.detail.value),this.orderReqeust.selfTake=e.detail.value?1:0,this.calcFreightPrice()},changeAddress:function(){e.navigateTo({url:"/pages/address/list?source=1"})},toggleMask:function(e){var t=this,r="show"===e?10:300,n="show"===e?1:0;this.maskState=2,setTimeout((function(){t.maskState=n}),r)},calcFreightPrice:function(){var e=this;e.addressData&&(e.orderReqeust.addressId=e.addressData.id),e.$api.request("freight","getFreightMoney",{orderRequestDTO:JSON.stringify(e.orderReqeust)}).then((function(t){e.orderReqeust.freightPrice=t.data}))},numberChange:function(e){this.number=e.number},submit:function(){var t=this;t.submiting||(t.addressData.id&&(t.orderReqeust.addressId=t.addressData.id),console.log(t.orderReqeust.selfTake,t.addressData.id),t.orderReqeust.selfTake||t.addressData.id?(t.submiting=!0,t.$api.request("order","takeOrder",{orderRequest:JSON.stringify(t.orderReqeust),channel:e.getSystemInfoSync().platform},(function(e){t.submiting=!1,t.$api.msg(e.errmsg)})).then((function(r){e.redirectTo({url:"/pages/pay/pay?orderno="+r.data+"&price="+t.orderReqeust.totalPrice})}))):t.$api.msg("非自取订单需要指定取货地址"))},selectCoupon:function(e){this.orderReqeust.coupon=e,this.maskState=0,this.calcFreightPrice()},stopPrevent:function(){}}};t.default=f}).call(this,r("543d")["default"])},"76b9":function(e,t,r){"use strict";r.r(t);var n=r("9ad5"),i=r("0f19");for(var a in i)"default"!==a&&function(e){r.d(t,e,(function(){return i[e]}))}(a);r("3890");var o,s=r("f0c5"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],o);t["default"]=u.exports},"9ad5":function(e,t,r){"use strict";var n;r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return a})),r.d(t,"a",(function(){return n}));var i=function(){var e=this,t=e.$createElement,r=(e._self._c,e.__map(e.couponList,(function(t,r){var n=e.__get_orig(t),i=!t.categoryId&&e.orderReqeust.totalPrice>=t.min||t.categoryId&&e.skuCategoryPriceMap[t.categoryId]&&e.skuCategoryPriceMap[t.categoryId]>t.min?e._f("dateFormat")(t.gmtEnd):null;return{$orig:n,f0:i}})));e.$mp.data=Object.assign({},{$root:{l0:r}})},a=[]}},[["3735","common/runtime","common/vendor"]]]);