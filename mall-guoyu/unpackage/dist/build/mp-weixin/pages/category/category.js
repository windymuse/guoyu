(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/category/category"],{"07b9":function(e,t,o){"use strict";o.r(t);var i=o("a128"),n=o.n(i);for(var s in i)"default"!==s&&function(e){o.d(t,e,(function(){return i[e]}))}(s);t["default"]=n.a},"495c":function(e,t,o){"use strict";o.r(t);var i=o("cc5f"),n=o("07b9");for(var s in n)"default"!==s&&function(e){o.d(t,e,(function(){return n[e]}))}(s);o("49c6");var r,a=o("f0c5"),c=Object(a["a"])(n["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],r);t["default"]=c.exports},"49c6":function(e,t,o){"use strict";var i=o("c78f"),n=o.n(i);n.a},a128:function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(o("a34a"));function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function r(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?s(Object(o),!0).forEach((function(t){a(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):s(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function a(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function c(e,t,o,i,n,s,r){try{var a=e[s](r),c=a.value}catch(u){return void o(u)}a.done?t(c):Promise.resolve(c).then(i,n)}function u(e){return function(){var t=this,o=arguments;return new Promise((function(i,n){var s=e.apply(t,o);function r(e){c(s,i,n,r,a,"next",e)}function a(e){c(s,i,n,r,a,"throw",e)}r(void 0)}))}}var d=function(){o.e("components/neil-modal/neil-modal").then(function(){return resolve(o("f2ef"))}.bind(null,o)).catch(o.oe)},l={data:function(){return{modalShow:!1,cateMaskState:0,headerPosition:"fixed",headerTop:"0px",loadingType:"more",filterIndex:0,priceOrder:0,goodsList:[],cateId:0,keywords:"",pageNo:1,isVip:!1,sizeCalcState:!1,tabScrollTop:0,currentId:1,flist:[],slist:[],tlist:[],rawData:[],selectOpen:["外卖","自取"],deliverType:1,goods:{},goodsNum:1,selectedSku:{},selectedSkuIndex:-1,merchantConfig:{},userConfig:{},showNoGoods:!1}},components:{neilModal:d},computed:{distance:function(){return this.userConfig.longitude&&this.merchantConfig.longitude?this.getDistance(this.userConfig.latitude,this.userConfig.longitude,this.merchantConfig.latitude,this.merchantConfig.longitude):0}},onShow:function(){var t=e.getStorageSync("deliverType");this.deliverType=t||0},onLoad:function(t){var o=this;return u(i.default.mark((function n(){var s;return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,o.loadData();case 2:console.log("onload",t),s=o,e.getLocation({type:"wgs84",success:function(e){console.log("当前位置的经度："+e.longitude),console.log("当前位置的纬度："+e.latitude),s.userConfig=e,s.$api.request("config","getMerchantConfig",{},(function(e){s.$api.msg(e.errmsg)})).then((function(e){console.log("商户信息",e.data),s.merchantConfig=e.data}))}});case 5:case"end":return i.stop()}}),n)})))()},onShareAppMessage:function(){return{title:"国渔鲜生小程序",desc:"全球鲜生供应商",path:"/pages/index/index"}},onShareTimeline:function(){return{}},methods:a({Rad:function(e){return e*Math.PI/180},getDistance:function(e,t,o,i){var n=this.Rad(e),s=this.Rad(o),r=n-s,a=this.Rad(t)-this.Rad(i),c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(r/2),2)+Math.cos(n)*Math.cos(s)*Math.pow(Math.sin(a/2),2)));return c*=6378.137,c=Math.round(1e4*c)/1e4,c=c.toFixed(1)+"km",console.log("经纬度计算的距离:"+c),c},chooseThis:function(t){console.log("good",t);var o=this;e.showLoading({title:"正在加载"}),o.$api.request("goods","getGoods",{spuId:t.id,groupShopId:""},(function(t){o.$api.msg(t.errmsg),e.hideLoading()})).then((function(t){if(o.goods=t.data,o.goods.groupShop){o.goods.price=o.goods.groupShop.minPrice,o.goods.vipPrice=o.goods.groupShop.minPrice;for(var i=0;i<o.goods.skuList.length;i++)for(var n=0;n<o.goods.groupShop.groupShopSkuList.length;n++)o.goods.skuList[i].id===o.goods.groupShop.groupShopSkuList[n].skuId&&(o.goods.skuList[i].price=o.goods.groupShop.groupShopSkuList[n].skuGroupShopPrice,o.goods.skuList[i].vipPrice=o.goods.groupShop.groupShopSkuList[n].skuGroupShopPrice)}e.hideLoading()})),this.goods=t,this.goodsNum=1,this.modalShow=!0},selectSpec:function(e,t){this.selectedSku=e,this.selectedSkuIndex=t},numSub:function(){this.goodsNum>1&&this.goodsNum--},numAdd:function(){this.goodsNum++},closeModal:function(){this.modalShow=!1,this.selectedSku={},this.selectedSkuIndex=-1},toggleSpec:function(e){var t=this;"show"===this.specClass?(this.specClass="hide",setTimeout((function(){t.specClass="none",t.toggleCallback&&(t.toggleCallback(),t.toggleCallback=void 0)}),150)):"none"===this.specClass&&(this.specClass="show",this.selectedSku.title||(this.selectedSku=this.goods.skuList[0],this.selectedSkuIndex=0))},navToDetailPage:function(t){var o=t.id;e.navigateTo({url:"/pages/product/detail?id=".concat(o)})},toFavorite:function(){var e=this;e.goods.collect?(e.goods.collect=!1,this.$api.request("collect","deleteCollect",{spuId:e.goods.id}).then((function(e){}))):(e.goods.collect=!0,this.$api.request("collect","addCollect",{spuId:e.goods.id}))},buy:function(){var t=this;if(t.selectedSku.id){var o={skuId:t.selectedSku.id,num:t.goodsNum,title:t.goods.title,originalPrice:t.selectedSku.originalPrice,price:t.selectedSku.price,vipPrice:t.selectedSku.vipPrice,skuTitle:t.selectedSku.title,spuImg:t.goods.img,skuImg:t.selectedSku.img,stock:t.selectedSku.stock,spuId:t.goods.id,categoryId:t.goods.categoryId,categoryIdList:t.goods.categoryIds};t.goods.groupShop&&(o["groupShopId"]=t.goods.groupShop.id);var i=[1];i[0]=o,t.$api.globalData.skuList=i,t.$api.globalData.selfTake=t.deliverType,e.navigateTo({url:"/pages/order/create?takeway=buy"})}else t.specClass="none",t.toggleSpec(),t.toggleCallback=t.buy},addCart:function(e){var t=this;t.selectedSku.id?t.$api.request("cart","addCartItem",{skuId:t.selectedSku.id,num:t.goodsNum}).then((function(e){t.$api.msg("添加购物车成功"),t.closeModal()})):(t.specClass="none",t.toggleSpec(),t.toggleCallback=t.addCart)},switchChange:function(e){console.log(e),this.deliverType=e},loadData:function(){var e=this;return u(i.default.mark((function t(){var o;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:o=e,e.$api.request("category","categoryList").then(function(){var e=u(i.default.mark((function e(t){var n,s,r,a,c,u;return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:o.rawData=t.data,o.flist=t.data||[],o.currentId=t.data[0].id,o.slist=t.data[0].childrenList||[],o.showNoGoods=!1,n=0;case 6:if(!(n<o.flist.length)){e.next=27;break}s=o.flist[n].childrenList||[],r=0;case 9:if(!(r<s.length)){e.next=24;break}a=s[r].childrenList||[],c=0;case 12:if(!(c<a.length)){e.next=21;break}return u=a[c],e.next=16,o.loadGoods(u.id);case 16:t=e.sent,u.goods=t;case 18:c++,e.next=12;break;case 21:r++,e.next=9;break;case 24:n++,e.next=6;break;case 27:o.showNoGoods=!0,console.log("flist 2"),console.log(o.flist),console.log(o.flist[0].childrenList[0].childrenList[0]),o.slist=o.flist[0].childrenList,o.$forceUpdate();case 33:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t)})))()},tabtap:function(e){console.log("tabtap ",e),this.currentId=e.id,this.slist=e.childrenList||[],this.tabScrollTop=0===this.tabScrollTop?1:0,this.$forceUpdate()},navToList:function(t){e.navigateTo({url:"/pages/product/list?tid=".concat(t)})},navigateToPage:function(t){e.navigateTo({url:t})},loadGoods:function(e){var t=this;return u(i.default.mark((function o(){var n,s;return i.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return n={},0===t.filterIndex&&(n={orderBy:"sales",isAsc:!1}),1===t.filterIndex&&(n={orderBy:"price",isAsc:1===t.priceOrder}),o.next=5,t.$api.request("goods","getGoodsPage",r({categoryId:e,title:"",pageNo:1},n));case 5:return s=o.sent,o.abrupt("return",s.data.items);case 7:case"end":return o.stop()}}),o)})))()}},"navToDetailPage",(function(t){var o=t.id;e.navigateTo({url:"/pages/product/detail?id=".concat(o)})}))};t.default=l}).call(this,o("543d")["default"])},c78f:function(e,t,o){},cc5f:function(e,t,o){"use strict";o.d(t,"b",(function(){return n})),o.d(t,"c",(function(){return s})),o.d(t,"a",(function(){return i}));var i={neilModal:function(){return o.e("components/neil-modal/neil-modal").then(o.bind(null,"f2ef"))}},n=function(){var e=this,t=e.$createElement,o=(e._self._c,(e.isVip?e.selectedSku.vipPrice?e.selectedSku.vipPrice:e.goods.vipPrice:e.selectedSku.price?e.selectedSku.price:e.goods.price)<(e.selectedSku.price?e.selectedSku.originalPrice:e.goods.originalPrice)?parseInt((e.isVip?e.selectedSku.vipPrice?e.selectedSku.vipPrice:e.goods.vipPrice:e.selectedSku.price?e.selectedSku.price:e.goods.price)/(e.selectedSku.originalPrice?e.selectedSku.originalPrice:e.goods.originalPrice)*100):null);e.$mp.data=Object.assign({},{$root:{m0:o}})},s=[]},d749:function(e,t,o){"use strict";(function(e){o("f494");i(o("66fd"));var t=i(o("495c"));function i(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=o,e(t.default)}).call(this,o("543d")["createPage"])}},[["d749","common/runtime","common/vendor"]]]);